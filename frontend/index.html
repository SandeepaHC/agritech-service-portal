<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>AgriTech Service Request Portal</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body {
  font-family: Arial, sans-serif;
  background:#f4f6f8;
  margin:0;
}

header {
  background:#2e7d32;
  color:white;
  padding:16px;
  text-align:center;
  font-size:22px;
}

.container {
  max-width:1000px;
  margin:20px auto;
  padding:15px;
}

.card {
  background:white;
  padding:20px;
  border-radius:8px;
  box-shadow:0 2px 10px rgba(0,0,0,0.1);
  margin-bottom:20px;
}

h2 {
  color:#2e7d32;
  margin-top:0;
}

/* FORM */
.grid {
  display:grid;
  grid-template-columns:1fr 1fr;
  gap:15px;
}

label {
  font-weight:bold;
  margin-bottom:5px;
  display:block;
}

input, select {
  width:100%;
  padding:10px;
  border-radius:5px;
  border:1px solid #ccc;
}

button {
  background:#2e7d32;
  color:white;
  border:none;
  padding:12px;
  border-radius:5px;
  cursor:pointer;
}

button:hover {
  background:#256428;
}

/* TABLE (DESKTOP) */
table {
  width:100%;
  border-collapse:collapse;
}

th, td {
  border:1px solid #ddd;
  padding:10px;
  text-align:center;
}

th {
  background:#e8f5e9;
}

/* MOBILE CARDS */
.mobile-list {
  display:none;
}

.mobile-card {
  border:1px solid #ddd;
  border-radius:6px;
  padding:12px;
  margin-bottom:12px;
  background:#fafafa;
}

.mobile-card div {
  margin-bottom:6px;
  font-size:14px;
}

/* RESPONSIVE */
@media (max-width: 768px) {
  .grid {
    grid-template-columns:1fr;
  }

  button {
    width:100%;
  }

  table {
    display:none;
  }

  .mobile-list {
    display:block;
  }
}

footer {
  text-align:center;
  font-size:13px;
  color:#666;
  padding:10px;
}
</style>
</head>

<body>

<header>ðŸŒ¾ AgriTech Farmer Service Portal</header>

<div class="container">

  <!-- FORM -->
  <div class="card">
    <h2>Submit Service Request</h2>
    <form id="form" class="grid">
      <div>
        <label>Farmer Name</label>
        <input id="name" required>
      </div>
      <div>
        <label>Service</label>
        <select id="service" required>
          <option value="">Select</option>
          <option>Labour</option>
          <option>Tractor</option>
          <option>Pest Control</option>
          <option>Irrigation Repair</option>
          <option>Harvesting</option>
        </select>
      </div>
      <div>
        <label>Priority</label>
        <select id="priority">
          <option>Low</option>
          <option selected>Medium</option>
          <option>High</option>
        </select>
      </div>
      <div>
        <label>Location</label>
        <input id="location" required>
      </div>
      <div>
        <button type="submit">Submit Request</button>
      </div>
    </form>
  </div>

  <!-- DASHBOARD -->
  <div class="card">
    <h2>Requests Dashboard</h2>
    <div id="summary"></div>

    <!-- Desktop Table -->
    <table>
      <thead>
        <tr>
          <th>Farmer</th>
          <th>Service</th>
          <th>Priority</th>
          <th>Location</th>
          <th>Status</th>
          <th>Requested At</th>
        </tr>
      </thead>
      <tbody id="tableBody"></tbody>
    </table>

    <!-- Mobile Cards -->
    <div class="mobile-list" id="mobileList"></div>
  </div>

</div>

<footer>Â© 2026 AgriTech Mini Project</footer>

<script>
const API = "https://agritech-backend-0f49.onrender.com/api";

document.getElementById("form").onsubmit = async (e) => {
  e.preventDefault();

  await fetch(API + "/request", {
    method:"POST",
    headers:{ "Content-Type":"application/json" },
    body:JSON.stringify({
      farmerName:name.value,
      service:service.value,
      priority:priority.value,
      location:location.value
    })
  });

  e.target.reset();
  loadRequests();
};

async function loadRequests(){
  const res = await fetch(API + "/requests");
  const data = await res.json();

  summary.innerText =
    `Total Requests: ${data.length} | Pending: ${data.filter(r=>r.status==="Pending").length}`;

  tableBody.innerHTML = "";
  mobileList.innerHTML = "";

  data.forEach(r=>{
    tableBody.innerHTML += `
      <tr>
        <td>${r.farmerName}</td>
        <td>${r.service}</td>
        <td>${r.priority}</td>
        <td>${r.location}</td>
        <td>${r.status}</td>
        <td>${new Date(r.createdAt).toLocaleString()}</td>
      </tr>`;

    mobileList.innerHTML += `
      <div class="mobile-card">
        <div><b>Farmer:</b> ${r.farmerName}</div>
        <div><b>Service:</b> ${r.service}</div>
        <div><b>Priority:</b> ${r.priority}</div>
        <div><b>Location:</b> ${r.location}</div>
        <div><b>Status:</b> ${r.status}</div>
      </div>`;
  });
}

loadRequests();
</script>

</body>
</html>
